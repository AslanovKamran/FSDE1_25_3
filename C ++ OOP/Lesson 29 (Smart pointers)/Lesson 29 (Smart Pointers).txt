üìö Smart pointers

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –¥–ª—è —á–µ–≥–æ –Ω–∞–º –Ω—É–∂–Ω—ã —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –≤—Å–ø–æ–º–Ω–∏–º —Ç–æ, –∫–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–ª–∏ —Å –æ–±—ã—á–Ω—ã–º–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏. –û–Ω–∏ –Ω–∞–º –Ω—É–∂–Ω—ã –±—ã–ª–∏ –≤ —Å–ª—É—á–∞—è—Ö –∫–æ–≥–¥–∞ –º—ã –≤—ã–¥–µ–ª—è–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–∞–º—è—Ç—å –ø–æ–¥ –Ω–∞—à–∏ –Ω—É–∂–¥—ã. –ù–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∞—Å—Å–∏–≤–∞ –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º –∫–æ–ª-–≤–æ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä:

    int main()
    {
        int* ptr = new int(5);
    }

üßë‚Äçüéì –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é —è–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–ª—é—Å–æ–º –∏ –º–∏–Ω—É—Å–æ–º —è–∑—ã–∫–∞ –°++. –û—á–µ–≤–∏–¥–Ω—ã–º –ø–ª—é—Å–æ–º —è–≤–ª—è–µ—Ç—Å—è —Å–∫–æ—Ä–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∑–∞ —Å—á–µ—Ç –≥—Ä–∞–º–æ—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏.

‚ö†Ô∏è –í —á–µ–º –ø—Ä–æ–±–ª–µ–º–∞ —Ç—É—Ç? –ó–¥–µ—Å—å –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ delete - –≤ –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∞–µ–º —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏. –í –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–æ–±—â–µ –Ω–µ—Ç –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ delete, –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–æ–º –ø–∞–º—è—Ç–∏ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤ —è–∑—ã–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.

–£–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ —ç—Ç–∏ –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏–≤–Ω–µ—Å—Ç–∏ —Ç–∞–∫–æ–π –∂–µ —Ñ-—Ü–∏–æ–Ω–∞–ª –≤ –°++. 

üß† –£–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∫–ª–∞—Å—Å-–æ–±–æ–ª–æ—á–∫–∞ –Ω–∞–¥ –ø—Ä–∏–º–∏—Ç—ã–≤–Ω—ã–º–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏. –í –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–∞—Ö –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏—è —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏, —å–µ–º —Å–∞–º—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Ç–µ–ø–µ—Ä—å –Ω–µ –æ–±—è–∑–∞–Ω –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —É–¥–∞–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

üß© –ó–∞—á–µ–º –≤–æ–æ–±—â–µ –Ω—É–∂–Ω—ã —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –µ—Å–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á—ã–µ? –í—Å–µ –¥–µ–ª–æ –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º —Ñ–∞–∫—Ç–æ—Ä–µ - –º–æ–∂–Ω–æ –±–∞–Ω–∞–ª—å–Ω–æ –∑–∞–±—ã—Ç—å –ø—Ä–æ–ø–∏—Å–∞—Ç—å delete –∏ –ø–æ–ª—É—á–∏—Ç—å —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏. –£—Ö—É–¥—à–∞–µ—Ç –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–∞–∫–∂–µ —Ç–æ, —á—Ç–æ —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –Ω–∏–∫–∞–∫ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∫–æ–¥–∞, —Ç.–µ. –∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ò–º–µ–Ω–Ω–æ –ø–æ —ç—Ç–æ–º—É –≤ –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –¥–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ —É–º–Ω—ã–º —É–∫–∞–∑–∞—Ç–µ–ª—è–º.

üßë‚Äçüíª –ü–æ–ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Å—Ç–µ–π—à–∏–π smart pointer. –ü–æ —Å–≤–æ–µ–π —Å—É—Ç–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–±–æ–ª–æ—á–∫–∞ –Ω–∞–¥ —É–∫–∞–∑–∞—Ç–µ–ª–µ–º, –≥–¥–µ –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏.

    template<class T>
    class SmartPointer
    {
    private:
        T* ptr;

    public:

        SmartPointer(T* pointer)
        {
            cout << "Constructor was called\n\n";
            ptr = pointer;
        }

        ~SmartPointer()
        {
            cout <<"\t\tDestructor was called\n\n";
            delete ptr;
        }

        T& operator*()
        {
            return *ptr;
        }
    };

üí° –î–∞–Ω–Ω—ã–π smart pointer —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º—ã–º –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º –∏–∑ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö. –í –Ω–µ–º –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –ª–∏—à—å –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è, —É–¥–∞–ª–µ–Ω–∏—è –∏ —Ä–∞–∑–∏–º–µ–Ω–æ–≤—ã–≤–∞–Ω–∏—è. –ú—ã –º–æ–∂–µ–º –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–æ –æ–±—ã—á–æ–≥–æ, –Ω–µ –∑–∞–º–æ—Ä–∞—á–∏–≤–∞—è—Å—å –Ω–∞ —Å—á–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è.

    int main()
    {
        SmartPointer<int> ptr = new int(5);
        cout << *ptr << endl;
    }

–ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—å –∏ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ –±–µ–∑ –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å–∏ delete –≤ —Ñ-—Ü–∏–∏ main.


üìö –¢–µ–ø–µ—Ä—å —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —É–∂–µ –≥–æ—Ç–æ–≤—ã–µ Smart pointer-—ã –≤ C++.
–ò—Ö —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–æ–≤, –≥–ª–∞–≤–Ω—ã–º–∏ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —è–≤–ª—è—é—Ç—Å—è 2. –ù–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –Ω–∏–º–∏ —Å–ª–µ–¥—É–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É:
    
    #include <memory>


–ò –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–æ—Ç —Ç–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É:
    
    SmartPointer<int> ptr1 = new int(5);
    SmartPointer<int> ptr2 = ptr1;

–°–µ–π—á–∞—Å —É –Ω–∞—Å —Å–∏—Ç—É–∞—Ü–∏—è —Ç–∞–∫–∞—è, —á—Ç–æ –¥–≤–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏ - –≤ —É—á–∞—Å—Ç–æ–∫, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ 5.

üëâ –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–¥–Ω–æ–≥–æ –∏–∑ —ç—Ç–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ - –æ—á–µ–≤–∏–¥–Ω–æ –æ—à–∏–±–∫–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏. –ö–∞–∫ –º–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å –¥–∞–Ω–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É:

1. –†–∞–¥–∏–∫–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –∑–∞–ø—Ä–µ—Ç–∏—Ç—å 2–º —É–∫–∞–∑–∞—Ç–µ–ª—è–º —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –æ–¥–Ω—É –∏ —Ç—É –∂–µ —è—á–µ–π–∫—É –ø–∞–º—è—Ç–∏

2. –ê —á—Ç–æ –µ—Å–ª–∏ –Ω–∞–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–¥–æ –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –æ–¥–Ω—É –∏ —Ç—É –∂–µ —è—á–µ–π–∫—É. –¢–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏.

–û–±–∞ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö smart pointer-–æ–≤ —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ memory.

üß† Unique pointer

–£–º–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤—Ç–æ—Ä–æ–º—É —É–∫–∞–∑–∞—Ç–µ–ª—é —É–∫–∞–∑—ã–≤–∞—Ç—å —Ç—É–¥–∞ –∂–µ –∫—É–¥–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—ã–π. –ö–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç:

–≠—Ç–æ —à–∞–±–ª–æ–Ω–Ω—ã–π –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞–¥—Ä–µ—Å—Å. –í –¥–∞–ª—å–Ω–µ–π—à–µ–º –∫ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É –Ω–∏–∫—Ç–æ –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è –ø—Ä—è–≤—è–∑–∞—Ç—å—Å—è –Ω–µ —Å–º–æ–∂–µ—Ç:

    int* rawPtr = new int(5);
    unique_ptr<int> ptr(rawPtr);

    //–∏–ª–∏ —Ç–∞–∫

    unique_ptr<int> ptr1 (new int(5));
    unique_ptr<int> ptr2 (ptr1); ‚ùå compile-time error;

Unique pointer –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –∞–¥—Ä–µ—Å–∞ 2–º —É–∫–∞–∑–∞—Ç–µ–ª—è–º. –û–¥–Ω–∞–∫–æ –≤ memory —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ñ-—Ü–∏—è move, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–º–µ—Ç –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å —Å –ø–µ—Ä–≤–æ–≥–æ –Ω–∞ –≤—Ç–æ—Ä–æ–π:

    unique_ptr<int> ptr1 (new int(5));
    unique_ptr<int> ptr2;

    ptr2 = move(ptr1);

üí° –ê–Ω–∞–ª–æ–≥–æ–º –¥–∞–Ω–Ω–æ–π —Ñ-—Ü–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –º–µ—Ç–æ–¥ swap, –∫–æ—Ç–æ—Ä—ã–π –ø–æ —Ñ–∞–∫—Ç—É –¥–µ–ª–∞–µ—Ç —Ç–æ–∂–µ —Å–∞–º–æ–µ:
    
    unique_ptr<int> ptr1 (new int(5));
    unique_ptr<int> ptr2;

    ptr2.swap(ptr1);

–í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ —ç—Ç–æ–º—É –≤ –Ω–µ–º –µ—Å—Ç—å —Å–µ—Ç—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω–µ—Ç –Ω–∞–º —É–∫–∞–∑–∞—Ç–µ–ª—å –≤ —Å—ã—Ä–æ–º –≤–∏–¥–µ:

    unique_ptr<int> ptr1 (new int(5));
    int* rawPtr = ptr1.get();

‚öôÔ∏è –°—É—â–µ—Å—Ç–≤—É–µ—Ç 2 –º–µ—Ç–æ–¥–∞ –æ—Ç–≤—è–∑–∫–∏ —É–º–Ω–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è –æ—Ç –∫–∞–∫–æ–≥–æ –ª–∏–±–æ –∞–¥—Ä–µ—Å–∞: reset & release, –æ–¥–Ω–∞–∫–æ –≤–µ–¥—É—Ç –æ–Ω–∏ —Å–µ–±—è –Ω–µ–º–Ω–æ–≥–æ –ø–æ —Ä–∞–∑–Ω–æ–º—É. 

    int* rawPtr = new int (5);
    unique_ptr<int> ptr1 (rawPtr);

    ptr.reset(); 

–ú–µ—Ç–æ–¥ reset –æ—Ç–≤—è–∑—ã–≤–∞–µ—Ç –Ω–∞—à —É–º–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å, –Ω–æ –ø–µ—Ä–µ–¥ —ç—Ç–∏–º –ø–æ–¥—á–∏—â–∞–µ—Ç –ø–∞–º—è—Ç—å. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —á–∏—Å–ª–æ 5 —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏.

–ù–∞–ø—Ä–æ—Ç–∏–≤ –∂–µ

    int* rawPtr = new int (5);
    unique_ptr<int> ptr1 (rawPtr);

    ptr.reset(); 




