üìö Run-Time Type Identification (RTTI)

–°–µ–≥–æ–¥–Ω—è —Ä–∞–∑–±–µ—Ä—ë–º –º–µ—Ö–∞–Ω–∏–∑–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã.
RTTI —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ Run-Time Type Identification ‚Äî ¬´–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è¬ª.

üîç –û–ø–µ—Ä–∞—Ç–æ—Ä typeid

RTTI –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫ –∫–∞–∫–æ–º—É —Ç–∏–ø—É —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –æ–±—ä–µ–∫—Ç.
–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä typeid.

    float number = 10;
    cout << typeid(number).name();

–û–ø–µ—Ä–∞—Ç–æ—Ä typeid –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ type_info,
—É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å –º–µ—Ç–æ–¥ .name(), –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π —Å—Ç—Ä–æ–∫—É —Å –∏–º–µ–Ω–µ–º —Ç–∏–ø–∞ (–æ–±—ã—á–Ω–æ –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞).


üêæ –ü—Ä–∏–º–µ—Ä —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π –∫–ª–∞—Å—Å–æ–≤

–î–ª—è —ç—Ç–æ–≥–æ –≤—Å–ø–æ–º–Ω–∏–º –Ω–∞—à—É –∏–µ—Ä–∞—Ä—Ö–∏—é –∫–ª–∞—Å—Å–æ–≤ Animal -> Car –∏ –¥—Ä.

    int main()
    {
        Animal* animal = new Cat();
        cout << typeid(*animal).name() << endl;
    }

–ó–¥–µ—Å—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è animal –∏–º–µ–µ—Ç —Ç–∏–ø Animal*, –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –≤ –Ω–µ–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ Cat. –ï—Å–ª–∏ –±—ã –º—ã –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–µ–ª–∏ typeid(animal).name(), –º—ã –±—ã –ø–æ–ª—É—á–∏–ª–∏ Animal*, –≤–µ–¥—å —ç—Ç–æ —Ç–∏–ø —Å–∞–º–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è. –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞, –Ω—É–∂–Ω–æ —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å: typeid(*animal).


üí° –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?
–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ-—Ä–∞–∑–Ω–æ–º—É —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤,
–∫–æ–≥–¥–∞ —Ç–∏–ø –∑–∞—Ä–∞–Ω–µ–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –µ–≥–æ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è). –ò —ç—Ç–æ —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–Ω—É—Ç—å —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:

    if(typeid(*animal) == typeid(Cat))
    {
        cout <<"This is a cat" << endl;
    }

    else
    {
        cout <<"Not a cat" << endl;
    }

–¢–∞–∫–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –∏ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è RTTI ‚Äî Run-Time Type Identification.


‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ

–ß—Ç–æ–±—ã typeid –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–ª —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ –Ω–∞ –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã, –≤ –±–∞–∑–æ–≤–æ–º –∫–ª–∞—Å—Å–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥. –ò–º–µ–Ω–Ω–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (vtable) —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∞–ª—å–Ω–æ–º —Ç–∏–ø–µ –æ–±—ä–µ–∫—Ç–∞. –ë–µ–∑ –Ω–µ—ë typeid(*animal) –≤–µ—Ä–Ω—ë—Ç —Ç–∏–ø Animal, –¥–∞–∂–µ –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è Cat.

üî§ –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–π–¥–µ–º –∫ —Ç–µ–º–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤

–†–∞–Ω–µ–µ –º—ã —É–∂–µ —É–º–µ–ª–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –æ–¥–∏–Ω —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –∫ –¥—Ä—É–≥–æ–º—É:

    double x = 3.14;
    cout << (int)x << endl;

–¢–∞–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–∏—à—ë–ª –∏–∑ —è–∑—ã–∫–∞ C –∏ —Å–µ–≥–æ–¥–Ω—è —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º.
–û–Ω –Ω–µ–±–µ–∑–æ–ø–∞—Å–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å –¥–∞–∂–µ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.

–í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º C++ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ç—ã—Ä–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤:

    static_cast;
    dynamic_cast;
    const_cast;
    reinterpret_cast;


–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∏—Ö –ø–æ –ø–æ—Ä—è–¥–∫—É.

1Ô∏è‚É£ static_cast
static_cast ‚Äî —ç—Ç–æ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ –æ–±—ã—á–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–∞, –∑–Ω–∞–∫–æ–º–æ–≥–æ –Ω–∞–º –ø–æ C.
–û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.


    double x = 3.14;
    cout << static_cast<int>(x) << endl; // ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

–ï—Å–ª–∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ‚Äî
–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –¥–∞—Å—Ç –ø—Ä–æ–≥—Ä–∞–º–º–µ –¥–∞–∂–µ —Å–æ–±—Ä–∞—Ç—å—Å—è:

    double x = 3.14;
    cout << static_cast<string>(x) << endl; // ‚ùå –û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏


–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, static_cast:
    –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –æ–±—ã—á–Ω–æ–≥–æ (int)x;
    –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏;

–í –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (double ‚Üí int, int ‚Üí char).

2Ô∏è‚É£ dynamic_cast

dynamic_cast –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ –∏–ª–∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏, –∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ –±–∞–∑–æ–≤–æ–º –∫–ª–∞—Å—Å–µ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥.

–û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –≤ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–π. –ü—É—Å—Ç—å –Ω–∞–ø—Ä–∏–º–µ—Ä –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–ª–∞—Å—Å–æ–≤ —Ç–æ–ª—å–∫–æ —É –∫–æ—Ç–∞ –µ—Å—Ç—å –º–µ—Ç–æ–¥ sleep

    void sleep()
    {
        cout << "ZzZzzzZ..." << endl;
    }

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —è –º–æ–≥—É –≤—ã–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ Cat. –¢–∞–∫ —Å–¥–µ–ª–∞—Ç—å –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è:

    Animal* pet = new Cat("Tom");
    pet->sleep(); ‚ùå 

–û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ —è —Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ –Ω–∞ Animal —Å–∏–¥–∏—Ç –∫–æ—Ç (–∞ —ç—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ typeid), —Ç–æ —è –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å —Ç—É—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ. –ü—Ä–∏ –ù–ï —É–¥–∞—á–Ω–æ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ dynamic_cast –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç nullptr –∏ —Å –ø–æ–º–æ—â—å—é –Ω–µ–≥–æ –º—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–¥–∞–ª–æ—Å—å –ª–∏ —Å–æ–≤–µ—Ä—à–∏—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ.

    Animal* pet = new Cat("Tom");
    if(typeid(*pet) == typeid(Cat))
    {
        –°at* cat = dynamic_cast<Cat*>(animal);
        if (cat != nullptr) 
            cat->sleep(); ‚úÖ
    }

–î–∞–Ω–Ω—ã–π —Ç–∏–ø –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Ö —Å–ª—É—á–∞—è—Ö –∫–æ–≥–¥–∞ –Ω–∞–º —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–≥–æ.

üêå const_cast –∏ reinterpret_cast —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö, –∞ –∫–æ–≥–¥–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —Ç–æ –æ–±—ã—á–Ω–æ –≤ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–º –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–µ–º –∫–æ–¥–µ. –¢–∞–∫–∏—Ö —Ç–∏–ø–æ–≤ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –Ω—É–∂–Ω–æ –∏–∑–±–µ–≥–∞—Ç—å.

3Ô∏è‚É£ const_cast

–≠—Ç–æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ const —É –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π. –ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è ‚Äî –æ–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç ‚Äú—Å–Ω—è—Ç—å‚Äù –∑–∞—â–∏—Ç—É –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

4Ô∏è‚É£ reinterpret_cast

–°–∞–º—ã–π ‚Äú–æ–ø–∞—Å–Ω—ã–π‚Äù –≤–∏–¥ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.
–û–Ω –±—É–∫–≤–∞–ª—å–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É: "–ù–µ –ø—Ä–æ–≤–µ—Ä—è–π –Ω–∏—á–µ–≥–æ, –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–π". –ù–∞–ø—Ä–∏–º–µ—Ä –º–æ–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å vector –≤ –°at –∏ —Ç.–ø.